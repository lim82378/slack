<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ActivityMapper">
	<!-- DAO에서 호출할 SQL쿼리문의 고유ID는 insertMember임 -->
	<!-- 내 활동 목록 조회 / 채널 초대 기준. -->
	<select id="selectActivityByChannel"
		resultType="com.slack.dto.ChannelMsgInviteWorkspaceUsersDto">
		<![CDATA[
		
			SELECT DISTINCT CI.user_invite userInvite,CI.user_invited userInvited, C.channel_name channelName, CI.invite_time inviteTime ,CI.channel_idx channelIdx, w.nickname,0 AS dmIdx,'INVITE' AS type, w.profile_image profileImage
	  		FROM channel_invite CI JOIN channel C 
			ON CI.channel_idx = C.channel_idx
            JOIN workspace_users W
            ON CI.user_invite = W.user_id AND C.workspace_idx = W.workspace_idx
			WHERE CI.user_invited = #{userInvited} AND W.workspace_idx = #{workspaceIdx}
			ORDER BY CI.invite_time DESC
		]]>
	</select>
	<select id="selectActivityListByMention" resultType="com.slack.dto.DmMentionDto">
		<![CDATA[
			SELECT DISTINCT m.user_id userId,d.dm_idx dmIdx, m.user_mentioned userMentioned, m.sent_time sentTime, d.content, w.nickname, w2.nickname AS mentionNickname, 'MENTION' AS type, d.content, w.profile_image profileImage
			FROM mention m JOIN dm d 
			ON m.dm_idx = d.dm_idx    
			JOIN workspace_users w
			ON m.user_id = w.user_id 
			AND m.workspace_idx = w.workspace_idx
			JOIN workspace_users w2
			ON m.user_mentioned = w2.user_id
			AND m.workspace_idx = w2.workspace_idx
			WHERE m.user_mentioned = #{userMentioned} 
			AND d.workspace_idx = #{workspaceIdx}
			ORDER BY m.sent_time DESC
		]]>
	</select>
</mapper>