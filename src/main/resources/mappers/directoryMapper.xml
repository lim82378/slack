<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="DirectoryMapper">
	<!-- [MJ] 워크스페이스 구성원 조회 -->
	<select id="getWorkspaceMembers" resultType="com.slack.dto.Users3Dto">
		SELECT user_id AS userId, nickname, profile_image AS profileImage 
	    FROM workspace_users 
	    WHERE workspace_idx = #{workspaceIdx}
	    ORDER BY 
	    <choose>
	        <when test="orderByType == '참여순'">join_time ASC</when>
	        <when test="orderByType == '오름'">nickname ASC</when>
	        <when test="orderByType == '내림'">nickname DESC</when>
	        <otherwise>
	            join_time ASC  
	        </otherwise>
	    </choose>
	</select>
	
	<!-- [MJ] 워크스페이스 내의 나의 프로필 이미지 조회 -->
	<select id="getWorkspaceMyImg" resultType="com.slack.dto.Users3Dto">
		SELECT profile_image AS profileImage 
	    FROM workspace_users 
	    WHERE workspace_idx = #{workspaceIdx} 
	    AND user_id = #{userId}
	</select>
	
	<!-- [MJ] 프로필 상세 조회 -->
	<select id="getProfileDetail" resultType="com.slack.dto.UsersProfileDto">
		SELECT u.user_id AS userId, 
		wu.nickname AS nickname, 
		u.name AS name, 
		u.phone_number AS phoneNumber, 
		u.condition AS condition,
		u.status AS status,
		u.title AS title,
		u.department AS department
		FROM users u
	    INNER JOIN workspace_users wu 
	    ON u.user_id = wu.user_id
	    WHERE wu.workspace_idx = #{workspaceIdx} 
	    AND wu.user_id = #{userId}
	</select>
	
	<!-- [MJ] 프로필 목록 조회 -->
	<select id="allProfileSelect" resultType="com.slack.dto.UsersProfileDto">
		SELECT u.user_id AS userId, 
		u.nickname AS nickname, 
		u.name AS name, 
		u.phone_number AS phoneNumber, 
		u.condition AS condition,
		u.status AS status,
		u.title AS title,
		u.department AS department
		FROM users u
	    INNER JOIN workspace_users wu 
	    ON u.user_id = wu.user_id
	    WHERE wu.workspace_idx = #{workspaceIdx} 
	</select>
	
	<!-- [MJ] 내 프로필 상태설정 -->
	<update id="setMyCondition">
		UPDATE users 
		SET condition = #{condition} 
		WHERE user_id = #{userId}
	</update>
	
	<!-- [MJ] 내 프로필 이름, 직함 변경 -->
	<update id="setMyProfileNameAndTitle">
		UPDATE users 
		SET name = #{name}, title = #{title} 
		WHERE user_id = #{userId}
	</update>
	
	<!-- [MJ] 내 프로필 워크스페이스의 닉네임 변경 -->
	<update id="setMyProfileNickname">
		UPDATE workspace_users 
		SET nickname = #{nickname} 
		WHERE user_id = #{userId} 
		AND workspace_idx = #{workspaceIdx}
	</update>
	
	<!-- [MJ] 워크스페이스 사용자 검색 -->
	<select id="workspaceUsersSearch" resultType="map">
		SELECT user_id AS userId, nickname, profile_image AS profileImage  
		FROM workspace_users 
		WHERE workspace_idx = #{workspaceIdx} 
		AND (nickname LIKE '%' || #{search} || '%')
	</select>
</mapper>

